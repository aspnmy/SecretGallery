# Caddy配置文件
# 自动支持HTTPS，使用Let's Encrypt证书

# 监听所有请求，自动配置HTTPS
:443 {
    # 静态文件根目录
    root * /usr/share/caddy
    
    # 启用文件浏览器（可选，用于调试）
    # file_server browse
    
    # Next.js的路由处理
    try_files {path} {path}/ /index.html
    
    # 静态文件缓存（30天）
    header Cache-Control "public, max-age=2592000"
    
    # 针对Next.js静态资源的特殊缓存配置
    @static {
        path /_next/static/*
    }
    header @static Cache-Control "public, immutable, max-age=31536000"
    
    # API代理配置（根据需要启用）
    # reverse_proxy /api/* http://backend:8000
    
    # 安全头配置
    header {
        # 防止XSS攻击
        X-XSS-Protection "1; mode=block"
        
        # 防止点击劫持
        X-Frame-Options DENY
        
        # 防止MIME类型嗅探
        X-Content-Type-Options nosniff
        
        # 启用HSTS
        Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
        
        # 启用内容安全策略（根据实际情况调整）
        Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; font-src 'self'; connect-src 'self'"
        
        # 启用Referrer策略
        Referrer-Policy "strict-origin-when-cross-origin"
    }
    
    # 启用文件服务
    file_server
}

# HTTP重定向到HTTPS
:80 {
    redir https://{host}{uri} permanent
}
